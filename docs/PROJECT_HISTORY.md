# Pulse Analysis 프로젝트 작업 기록

**문서 목적:** 이 문서는 `pulse_analysis` 프로젝트의 데이터셋 생성 및 정제 과정에 대한 단계별 기록을 상세히 남겨, 향후 담당자가 변경되거나 분석 과정을 복기할 때 혼선이 없도록 하는 것을 목표로 합니다.

---

## 2026년 1월 9일: 데이터셋 정제 및 기준 문서화

### Milestone: 신뢰성 있는 충돌 가속도 데이터셋 확보

이날 작업은 원본 NHTSA 데이터베이스에서 분석에 적합한 테스트를 선별하고, 여러 센서 채널 중 가장 신뢰도 높은 데이터를 식별하여 최종 분석용 데이터셋을 생성하는 과정을 포함합니다.

---

### 단계 1: 분석 대상 선정 및 최초 후보군 추출 (`matched_sensor_list.csv`)

**목표:** 본격적인 파형 분석 전, 조건에 맞는 테스트를 필터링하고 분석할 센서 채널의 후보 목록을 생성.

-   **담당 스크립트:** `scripts/matched_sensor_list_v4.py`
-   **입력 데이터:**
    -   `data/crash_classification_final.csv`: 사전에 분류된 충돌 유형 정보.
    -   `data/downloads/`: 원본 TDMS 파일 메타데이터.
-   **출력 데이터:** `data/matched_sensor_list.csv`

#### 세부 필터링 및 선정 기준:
1.  **충돌 유형 필터링:**
    -   분석의 일관성을 위해 `crash_classification_final.csv`에 정의된 충돌 유형 중 **`FRONTAL_FIXED_WALL` (정면 고정 벽 충돌)**만 대상으로 한정했습니다. 이는 가장 표준화된 테스트 조건이기 때문입니다.

2.  **센서 채널 식별 (규칙 기반):**
    -   TDMS 파일의 메타데이터를 스캔하여 NHTSA 명명 규칙에 따라 아래 조건을 만족하는 센서만 후보로 간주했습니다.
        -   **Object (`[0:2]`):** `10` (차량 자체를 의미)
        -   **Sensor Type (`[12:14]`):** `AC` (가속도 센서)
        -   **Axis (`[14]`):** `1` (차량 진행 방향, X축)

3.  **최적 센서 쌍(Pair) 매칭 (우선순위 기반):**
    -   차체 전체의 거동을 가장 잘 대표할 것으로 예상되는 위치의 센서부터 우선적으로 좌/우 쌍을 탐색했습니다.
        -   **1순위 (주요 구조물):** `FORA`(전방 바닥), `FLOR`(바닥), `SEAT`(시트 프레임) 등.
        -   **2순위 (주변 구조물):** `SILL`(사이드 실), `DOOR`(도어).
        -   **3순위 (단일 채널):** 만약 좌/우 쌍을 찾지 못하면, 1순위 위치에 있는 단일 채널이라도 후보로 등록 (`_Single`로 표기).

---

### 단계 2: 최종 데이터셋 생성 및 물리적 검증 (`final_clean_dataset_rev.csv`)

**목표:** 1단계 후보군을 바탕으로 실제 파형 데이터를 분석하여 물리적으로 타당하고 가장 대표성 있는 채널을 최종 확정.

-   **담당 스크립트:** `scripts/finalize_dataset.py` (이전 단계인 `create_clean_dataset.py`의 로직을 포함 및 개선)
-   **입력 데이터:**
    -   `data/final_clean_dataset.csv`: 1차 정제된 목록.
    -   `data/nhtsa_data.db`: Crush, Peak G 등 공식 리포트 값 참조.
    -   `data/downloads/`: 전체 원본 TDMS 파형 데이터.
-   **출력 데이터:** `data/final_clean_dataset_rev.csv`

#### 세부 정제 및 검증 기준:
1.  **'10' 시리즈 채널 규칙 강화:**
    -   분석의 일관성을 위해 **채널 이름이 `10`으로 시작하는 것만 최종 데이터로 인정**하는 규칙을 적용했습니다.

2.  **최적 채널 재탐색 (`Comprehensive_Optimization_10only`):**
    -   기존에 선택된 채널의 품질이 기준 미달일 경우, 해당 테스트의 TDMS 파일 내 **모든 '10' 시리즈 채널을 재탐색**하여 최적의 채널을 다시 선정했습니다.
    -   **탐색 우선순위:** `VEHCCG`(무게중심) > `SEAT` > `SILL`/`DOOR` 순으로 가중치를 부여.

3.  **물리적 타당성 검증 (Scoring & Validation):**
    -   선택된 채널의 파형 데이터를 이중 적분하여 계산된 물리량이 공식 리포트 및 물리 법칙에 부합하는지 검증했습니다.
    -   **Energy Ratio (에너지 비율):** `측정 운동에너지 / 이론상 초기 운동에너지`. **0.8 ~ 1.2** 범위를 정상으로 간주.
    -   **Calculated Crush (계산된 변형량):** **1000mm 미만**이어야 하며, 공식 값과의 차이가 적을수록 높은 점수를 받습니다.
    -   **Calculated Peak G (계산된 최대 가속도):** 공식 값과의 차이가 **30g 이내**여야 합니다.

4.  **최종 상태 (`status`) 분류:**
    -   **`Valid`:** 위의 모든 물리적 타당성 검증 기준을 통과한 데이터.
    -   **`Outlier`:** 유효한 '10' 채널은 찾았으나, 물리적 검증 결과가 비정상 범위에 속하는 데이터.
    -   **`No Valid 10-Channel`:** 분석 가능한 '10' 채널을 찾지 못한 테스트.
    -   **`Missing TDMS` / `Error`:** 원본 파일이 없거나 처리 중 오류가 발생한 경우.

---

### 단계 3: 작업 내용 문서화

**목표:** 위 모든 과정을 요약하여 텍스트 파일로 저장.

-   **담당 도구:** Gemini CLI (`write_file` tool)
-   **출력 파일:** `data/dataset_generation_description.txt`
-   **내용:** 이 `PROJECT_HISTORY.md`에 기술된 1, 2단계의 핵심 내용을 요약하여 정리했습니다.
